"use client";

import { Badge } from "@/components/ui/badge";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip";
import { cn } from "@/lib/utils";
import type { SSVCDecision, SSVCExploitation, SSVCAutomatable } from "@/lib/api";
import { useTranslations } from "next-intl";

interface SSVCDecisionBadgeProps {
  decision: SSVCDecision;
  showTooltip?: boolean;
  size?: "sm" | "md" | "lg";
  className?: string;
}

export function SSVCDecisionBadge({
  decision,
  showTooltip = true,
  size = "md",
  className,
}: SSVCDecisionBadgeProps) {
  const t = useTranslations("SSVC");

  const getDecisionStyles = () => {
    switch (decision) {
      case "immediate":
        return "bg-red-600 text-white hover:bg-red-700 border-red-600";
      case "out_of_cycle":
        return "bg-orange-500 text-white hover:bg-orange-600 border-orange-500";
      case "scheduled":
        return "bg-yellow-500 text-black hover:bg-yellow-600 border-yellow-500";
      case "defer":
        return "bg-green-600 text-white hover:bg-green-700 border-green-600";
      default:
        return "bg-gray-500 text-white hover:bg-gray-600 border-gray-500";
    }
  };

  const getSizeStyles = () => {
    switch (size) {
      case "sm":
        return "text-xs px-1.5 py-0.5";
      case "lg":
        return "text-sm px-3 py-1.5";
      default:
        return "text-xs px-2 py-1";
    }
  };

  const badge = (
    <Badge
      variant="outline"
      className={cn(
        getDecisionStyles(),
        getSizeStyles(),
        "font-medium uppercase",
        className
      )}
    >
      {t(`decision.${decision}`)}
    </Badge>
  );

  if (!showTooltip) {
    return badge;
  }

  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>{badge}</TooltipTrigger>
        <TooltipContent>
          <p className="font-medium">{t(`decision.${decision}`)}</p>
          <p className="text-xs text-muted-foreground">
            {t(`decisionDescription.${decision}`)}
          </p>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}

interface SSVCExploitationBadgeProps {
  exploitation: SSVCExploitation;
  isAuto?: boolean;
  size?: "sm" | "md";
  className?: string;
}

export function SSVCExploitationBadge({
  exploitation,
  isAuto = false,
  size = "md",
  className,
}: SSVCExploitationBadgeProps) {
  const t = useTranslations("SSVC");

  const getStyles = () => {
    switch (exploitation) {
      case "active":
        return "bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-400 dark:border-red-800";
      case "poc":
        return "bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/30 dark:text-orange-400 dark:border-orange-800";
      case "none":
        return "bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700";
      default:
        return "bg-gray-100 text-gray-700 border-gray-200";
    }
  };

  return (
    <Badge
      variant="outline"
      className={cn(
        getStyles(),
        size === "sm" ? "text-xs px-1.5 py-0.5" : "text-xs px-2 py-1",
        className
      )}
    >
      {t(`exploitation.${exploitation}`)}
      {isAuto && (
        <span className="ml-1 text-[10px] opacity-60">(auto)</span>
      )}
    </Badge>
  );
}

interface SSVCAutomatableBadgeProps {
  automatable: SSVCAutomatable;
  isAuto?: boolean;
  size?: "sm" | "md";
  className?: string;
}

export function SSVCAutomatableBadge({
  automatable,
  isAuto = false,
  size = "md",
  className,
}: SSVCAutomatableBadgeProps) {
  const t = useTranslations("SSVC");

  const getStyles = () => {
    switch (automatable) {
      case "yes":
        return "bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/30 dark:text-orange-400 dark:border-orange-800";
      case "no":
        return "bg-gray-100 text-gray-700 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700";
      default:
        return "bg-gray-100 text-gray-700 border-gray-200";
    }
  };

  return (
    <Badge
      variant="outline"
      className={cn(
        getStyles(),
        size === "sm" ? "text-xs px-1.5 py-0.5" : "text-xs px-2 py-1",
        className
      )}
    >
      {t(`automatable.${automatable}`)}
      {isAuto && (
        <span className="ml-1 text-[10px] opacity-60">(auto)</span>
      )}
    </Badge>
  );
}

interface SSVCIndicatorProps {
  decision: SSVCDecision;
  className?: string;
}

export function SSVCIndicator({ decision, className }: SSVCIndicatorProps) {
  const t = useTranslations("SSVC");

  const getColor = () => {
    switch (decision) {
      case "immediate":
        return "bg-red-500";
      case "out_of_cycle":
        return "bg-orange-500";
      case "scheduled":
        return "bg-yellow-500";
      case "defer":
        return "bg-green-500";
      default:
        return "bg-gray-400";
    }
  };

  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <span
            className={cn(
              "inline-block w-2.5 h-2.5 rounded-full",
              getColor(),
              className
            )}
            aria-label={`SSVC: ${t(`decision.${decision}`)}`}
          />
        </TooltipTrigger>
        <TooltipContent>
          <p className="font-medium">SSVC: {t(`decision.${decision}`)}</p>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}
